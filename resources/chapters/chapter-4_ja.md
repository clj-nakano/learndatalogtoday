# クエリの詳細

以前に述べたように、datomは`[eid attr val tx]`の４要素からなるタプルです。これまでのところ、値とエンティティIDについてのみの質問しかしてきませんでした。属性とトランザクションについても問い合わせができることを覚えておくことは重要です。

## 属性

例えば、データベース内の`person`エンティティに紐付けられている属性全てを検索したいとします。`:person/name`属性が存在することは分かっていますが、まだ見たことのない属性が他にもあるのでしょうか？

    [:find ?attr
     :where 
     [?p :person/name]
     [?p ?attr]]

上記のクエリは知りたい属性を参照しているエンティティIDのセットを返します。実際のキーワードを取得するためには、`:db/ident`属性を使って検索する必要があります。

    [:find ?attr
     :where
     [?p :person/name]
     [?p ?a]
     [?a :db/ident ?attr]]

これができるのは、属性もデータベース内ではエンティティとして管理されているからです。

## トランザクション

下記のような、トランザクションに関する情報を取得するクエリを実行することも可能です。

* ある事実が表明されたのはいつか？
* ある事実が撤回されたのはいつか？
* あるトランザクションに属する事実は何か？
* などなど

トランザクションエンティティは、datomベクタの第４要素です。標準では、トランザクションに紐付けられている属性は`:db/txInstant`だけです。これはデータベースにトランザクションがコミットされたタイムスタンプです。

"James Cameron"がpersonエンティティの名前として設定されたのがいつなのか検索するために、この第４要素を用いている例です。

    [:find ?timestamp
     :where
     [?p :person/name "James Cameron" ?tx]
     [?tx :db/txInstant ?timestamp]]
     
