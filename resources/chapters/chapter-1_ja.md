# 基本のクエリ

使用するデータベースに入っている情報は主に80年代の**映画**についてです。
映画のタイトル、公開年、監督、キャストなどの情報について検索してもらいます。
後の章で、データベースの内容と構成についてより詳しい説明があります。

Datomicで使われているデータモデルは、**datom**と呼ばれる原子性をもつ事実をもとに構築されています。
Datomは、下記の４要素で構成されています。

* エンティティID (Entity ID)
* 属性 (Attribute)
* 値 (Value)
* トランザクションID (Transaction ID)

データベースは下記のような、階層構造のないdatomで構成されていると考えることができます。

    [<e-id>  <attribute>      <value>          <tx-id>]
    ...
    [ 167    :person/name     "James Cameron"    102  ]
    [ 234    :movie/title     "Die Hard"         102  ]
    [ 234    :movie/year      1987               102  ]
    [ 235    :movie/title     "Terminator"       102  ]
    [ 235    :movie/director  167                102  ]
    ...

最後の２つのdatomは同じエンティティIDを持っていることに注目してください。
これは、同じ映画についての事実であることを示しています。
また、最後のdatomの値が最初のdatomのエンティティIDと一致しています。
これは、`:move/director`属性の値がエンティティであることを示しています。
上記のdatomは全て同じトランザクションの中で追加されたので、同じ値が
トランザクションIDに入っています。

クエリは、キーワード`:find`で始まり、`?`シンボルで始まる一つ以上の**パターン変数**(例：`?title`)が続くベクタとして表現されています。
find句の後には、指定された**データパターン**にマッチするdatomだけに制限する`:where`句が続きます。

例えば、このクエリは属性`:persion/name`の値が`"Ridley Scott"`であるエンティティIDを全て検索します。

    [:find ?e
     :where
     [?e :person/name "Ridley Scott"]]


データパターンとは、一部がパターン変数に置き換えられたdatomのことです。
クエリエンジンは一つ一つのパターン変数が取りうる値を検索し、`:find`句で指定した変数を返すのが仕事です。

シンボル`_`は無視したいデータパターンのためのワイルドカードとして使用できます。
また、データパターンの後ろに続く値を省略することもできます。
上記のクエリはdatomのトランザクション部分を無視しており、下記のクエリと同等です。


    [:find ?e
     :where
     [?e :person/name "Ridley Scott" _]]
